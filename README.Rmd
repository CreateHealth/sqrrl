---
title: "README"
author: "Garrick Aden-Buie"
date: "6/14/2017"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, comment = '', prompt = TRUE)
```

## 🐿 sqrrrl

`sqrrrl` is a small collection of utility functions that help build text-based SQL queries in an R-style native-feeling and functional manner.

Unlike other packages that build SQL queries using an object-oriented style, `sqrrrl` provides small functions that produce SQL snippets and can be linked together to compose SQL queries.
The result is that the code to produce the SQL statement reads much like the SQL statement iteself.
On the other hand, `sqrrrl` doesn't know anything about your database and can't help you out with completions, etc.

## Installation

```r
# install.packages('devtools')
devtools::install_github('gadenbuie/sqrrrl')
```

## Quick Overview

```{r quick overview}
library(sqrrrl)

# ---- SELECT ----
SELECT()
SELECT('col1', 'col2', 'col3')
SELECT(newcol = 'col1', avg_col1 = 'mean(col1)')

# ---- FROM ----
FROM('table1')
FROM('table1', 'table2')
FROM(t1 = 'table1', t2 = 'table2', 'table3')

# ---- WHERE ----
WHERE('col1 IS NOT NULL')
WHERE(cond = TRUE, 'col1 = 2', 'col2 >= 10')
WHERE(cond = FALSE, 'col1 = 2', 'col2 >= 10')

# ---- IN ----
'id' %IN% 1:4
'id' %IN% letters[1:3]
# Note: if left-hand-side length == 1, then LHS is unquoted (for subqueries)
'id' %IN% paste(SELECT('id'), FROM('other_table'))
'in' %IN% quotes(letters[1])

# ---- LIKE ----
'text_col' %LIKE% 'Prefix%'
'text_col' %LIKE% c('Prefix1%', 'Prefix2%')

# ---- Comparison Operators ----
eq(id = 4)
neq(id = 4)
lt(id = 4)
leq(id = 4)
gt(id = 4)
geq(id = 4)

# ---- Contatenation Operators ----
AND(eq(id = 3, class = 'text_value'), geq(date = '2017-06-14'))
OR(eq(id = 9, id = 12), leq(id = 5))
# Concatenate snippets with the %+% infix operator
SELECT() %+% FROM('table') %+% WHERE(eq(id = 10))

# ---- Complete Example ----
(example_query <- 
  SELECT('mpg', weight = 'wt', cylinders = 'cyl') %+%
  FROM('mtcars') %+%
  WHERE(
    lt(gear = 4),
    geq(mpg = 15),
    'cyl' %IN% c(4,6)
  ))
```

## Formatting SQL Queries

`sqrrrl` also provides a simple wrapper for <https://github.com/andialbrecht/sqlparse>, a Python package for formatting SQL queries.
`sqlparse` can be installed via `pip install --upgrade sqlparse`, thereafter making available the system command `sqlformat`.

`sqrrrl::sqlformat()` pretty-prints SQL queries, such as the one above.

```{r sqlformat, results='asis'}
example <- sqlformat(example_query, header = 'A Beautifully Formatted Example Query')
cat(example)
```